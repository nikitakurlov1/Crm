<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö - SellBit</title>
    <meta name="theme-color" content="#0066CC">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SellBit">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="SellBit">
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0066CC 0%, #004499 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: 500;
        }
        
        .status-value {
            font-weight: 600;
        }
        
        .status-value.success {
            color: #4CAF50;
        }
        
        .status-value.error {
            color: #F44336;
        }
        
        .status-value.syncing {
            color: #FFC107;
        }
        
        .btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .btn.primary {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .sync-log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .data-preview {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .data-preview h4 {
            color: #FFD700;
            margin-bottom: 10px;
        }
        
        .data-preview pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 11px;
        }
        
        .sync-indicator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 10px;
            background: rgba(33, 150, 243, 0.2);
            color: #2196F3;
        }
        
        .sync-indicator.syncing {
            background: rgba(255, 193, 7, 0.2);
            color: #FFC107;
            animation: spin 1s linear infinite;
        }
        
        .sync-indicator.success {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        
        .sync-indicator.error {
            background: rgba(244, 67, 54, 0.2);
            color: #F44336;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö</h1>
        
        <div class="status-card">
            <h3>üìä –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h3>
            <div class="status-item">
                <span class="status-label">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É:</span>
                <span class="status-value" id="internetStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É:</span>
                <span class="status-value" id="serverStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="status-item">
                <span class="status-label">–°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:</span>
                <span class="status-value" id="syncStatus">–û–∂–∏–¥–∞–Ω–∏–µ...</span>
            </div>
            <div class="status-item">
                <span class="status-label">–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</span>
                <span class="status-value" id="lastSync">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
            </div>
        </div>
        
        <div class="status-card">
            <h3>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
            <div style="text-align: center;">
                <button class="btn primary" onclick="testSync()">
                    <span class="sync-indicator" id="testSyncIndicator">üîÑ</span>
                    –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
                </button>
                <button class="btn" onclick="forceSync()">
                    <span class="sync-indicator" id="forceSyncIndicator">üîÑ</span>
                    –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
                </button>
                <button class="btn" onclick="clearLog()">
                    –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥
                </button>
                <a href="home.html" class="btn">
                    üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
                </a>
            </div>
        </div>
        
        <div class="status-card">
            <h3>üìã –õ–æ–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h3>
            <div class="sync-log" id="syncLog">
                <div>–õ–æ–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...</div>
            </div>
        </div>
        
        <div class="status-card">
            <h3>üìä –î–∞–Ω–Ω—ã–µ</h3>
            <div class="data-preview">
                <h4>üí∞ –ë–∞–ª–∞–Ω—Å</h4>
                <pre id="balanceData">–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</pre>
            </div>
            <div class="data-preview">
                <h4>üìà –¶–µ–Ω—ã –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç</h4>
                <pre id="cryptoData">–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</pre>
            </div>
            <div class="data-preview">
                <h4>üìã –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h4>
                <pre id="transactionData">–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</pre>
            </div>
        </div>
    </div>

    <script src="server-connection.js"></script>
    <script src="data-sync.js?v=3"></script>
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('syncLog');
            const time = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            logDiv.innerHTML += `<div>[${time}] ${icon} ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(id, status, message) {
            const element = document.getElementById(id);
            element.textContent = message;
            element.className = `status-value ${status}`;
        }
        
        function updateSyncIndicator(id, status) {
            const indicator = document.getElementById(id);
            indicator.className = `sync-indicator ${status}`;
            
            if (status === 'syncing') {
                indicator.textContent = 'üîÑ';
            } else if (status === 'success') {
                indicator.textContent = '‚úÖ';
            } else if (status === 'error') {
                indicator.textContent = '‚ùå';
            } else {
                indicator.textContent = 'üîÑ';
            }
        }
        
        function updateDataPreview(id, data) {
            const element = document.getElementById(id);
            element.textContent = JSON.stringify(data, null, 2);
        }
        
        function updateLastSync() {
            if (window.dataSync) {
                const lastSync = window.dataSync.getLastSync();
                if (lastSync) {
                    updateStatus('lastSync', 'success', lastSync.toLocaleString());
                } else {
                    updateStatus('lastSync', 'error', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ');
                }
            }
        }
        
        async function testSync() {
            log('–ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...', 'info');
            updateSyncIndicator('testSyncIndicator', 'syncing');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
                if (navigator.onLine) {
                    updateStatus('internetStatus', 'success', '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ');
                    log('–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω', 'success');
                } else {
                    updateStatus('internetStatus', 'error', '–û—Ç–∫–ª—é—á–µ–Ω–æ');
                    log('–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω', 'error');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
                if (window.serverConnection && window.serverConnection.getStatus()) {
                    updateStatus('serverStatus', 'success', '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ');
                    log('–°–µ—Ä–≤–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω', 'success');
                } else {
                    updateStatus('serverStatus', 'error', '–û—Ç–∫–ª—é—á–µ–Ω–æ');
                    log('–°–µ—Ä–≤–µ—Ä –æ—Ç–∫–ª—é—á–µ–Ω', 'error');
                    return;
                }
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
                updateStatus('syncStatus', 'syncing', '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...');
                log('–ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö...', 'info');
                
                if (window.dataSync) {
                    await window.dataSync.forceSync();
                    updateStatus('syncStatus', 'success', '–ó–∞–≤–µ—Ä—à–µ–Ω–∞');
                    log('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                } else {
                    updateStatus('syncStatus', 'error', '–ú–æ–¥—É–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    log('–ú–æ–¥—É–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                }
                
                updateSyncIndicator('testSyncIndicator', 'success');
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
                updateStatus('syncStatus', 'error', '–û—à–∏–±–∫–∞');
                updateSyncIndicator('testSyncIndicator', 'error');
            }
            
            updateLastSync();
        }
        
        async function forceSync() {
            log('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...', 'info');
            updateSyncIndicator('forceSyncIndicator', 'syncing');
            
            try {
                if (window.dataSync) {
                    await window.dataSync.forceSync();
                    log('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
                    updateSyncIndicator('forceSyncIndicator', 'success');
                } else {
                    log('–ú–æ–¥—É–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                    updateSyncIndicator('forceSyncIndicator', 'error');
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
                updateSyncIndicator('forceSyncIndicator', 'error');
            }
            
            updateLastSync();
        }
        
        function clearLog() {
            document.getElementById('syncLog').innerHTML = '<div>–õ–æ–≥ –æ—á–∏—â–µ–Ω</div>';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã
            updateStatus('internetStatus', navigator.onLine ? 'success' : 'error', 
                        navigator.onLine ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–û—Ç–∫–ª—é—á–µ–Ω–æ');
            
            if (window.serverConnection) {
                updateStatus('serverStatus', window.serverConnection.getStatus() ? 'success' : 'error',
                           window.serverConnection.getStatus() ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–û—Ç–∫–ª—é—á–µ–Ω–æ');
            }
            
            if (window.dataSync) {
                updateStatus('syncStatus', window.dataSync.isSyncInProgress() ? 'syncing' : 'success',
                           window.dataSync.isSyncInProgress() ? '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...' : '–ì–æ—Ç–æ–≤–æ');
            }
            
            updateLastSync();
            
            // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è
            window.addEventListener('online', () => {
                updateStatus('internetStatus', 'success', '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ');
                log('–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'success');
            });
            
            window.addEventListener('offline', () => {
                updateStatus('internetStatus', 'error', '–û—Ç–∫–ª—é—á–µ–Ω–æ');
                log('–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω', 'warning');
            });
            
            // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            if (window.dataSync) {
                const originalShowSyncNotification = window.dataSync.showSyncNotification;
                window.dataSync.showSyncNotification = function(message, type) {
                    originalShowSyncNotification.call(this, message, type);
                    log(`–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: ${message}`, type);
                };
            }
        });
    </script>
</body>
</html>
